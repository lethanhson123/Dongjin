import { Component, OnInit, ViewChild } from '@angular/core';
import { environment } from 'src/environments/environment';
import { NotificationService } from 'src/app/shared/notification.service';
import { MatDialog, MatDialogConfig } from '@angular/material/dialog';
import { MatTableDataSource } from '@angular/material/table';
import { MatSort } from '@angular/material/sort';
import { MatPaginator } from '@angular/material/paginator';
import { [ClassName] } from 'src/app/shared/[ClassName].model';
import { [ClassName]Service } from 'src/app/shared/[ClassName].service';
import { [ClassName]Component } from './[ClassName]-detail/[ClassName]-detail.component';


@Component({
  selector: 'app-[ClassName]',
  templateUrl: './[ClassName].component.html',
  styleUrls: ['./[ClassName].component.css']
})
export class [ClassName]Component implements OnInit {

  dataSource: MatTableDataSource<any>
    ;
    @ViewChild(MatSort) sort: MatSort;
    @ViewChild(MatPaginator) paginator: MatPaginator;
    isShowLoading: boolean = false;
    searchString: string = environment.InitializationString;
    id: any;
    constructor(
    public [ClassName]Service: [ClassName]Service,
    public NotificationService: NotificationService,
    private dialog: MatDialog
    ) { }

    ngOnInit(): void {
    this.onSearch();
    }

    GetAllToListAsync() {
    this.isShowLoading = true;
    this.[ClassName]Service.GetAllToListAsync().subscribe(
    res => {
    this.[ClassName]Service.list = res as [ClassName][];
    this.dataSource = new MatTableDataSource(this.[ClassName]Service.list.sort((a, b) => (a.SortOrder > b.SortOrder ? 1 : -1)));
    this.dataSource.sort = this.sort;
    this.dataSource.paginator = this.paginator;


    this.isShowLoading = false;
    },
    err => {
    this.isShowLoading = false;
    }
    );
    }
    onSearch() {
    if (this.searchString.length > 0) {
    this.dataSource.filter = this.searchString.toLowerCase();
    }
    else {
    this.GetAllToListAsync();
    }
    }
    onAdd(ID: any) {
    this.[ClassName]Service.GetByIDAsync(ID).subscribe(
    res => {
    this.[ClassName]Service.formData = res as [ClassName];
    const dialogConfig = new MatDialogConfig();
    dialogConfig.disableClose = true;
    dialogConfig.autoFocus = true;
    dialogConfig.width = environment.DialogConfigWidth;
    dialogConfig.data = { ID: ID };
    const dialog = this.dialog.open([ClassName]DetailComponent, dialogConfig);
    dialog.afterClosed().subscribe(() => {
    this.GetAllToListAsync();
    });
    },
    err => {
    }
    );
    }
    onDelete(element: [ClassName]) {
    if (confirm(environment.DeleteConfirm)) {
    this.[ClassName]Service.RemoveAsync(element.ID).subscribe(
    res => {
    this.onSearch();
    },
    err => {
    this.NotificationService.warn(environment.SaveNotSuccess);
    }
    );
    }
    }
    }
